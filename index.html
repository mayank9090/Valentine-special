<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VALENTINE'S SPECIAL ‚ù§Ô∏è</title>
    <link rel="icon" type="image/png" href="https://files.catbox.moe/k3769t.png">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #ff4757;
            --glass: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(-45deg, #1a0000, #000000, #3d0000, #0a0a0a);
            background-size: 400% 400%;
            animation: gradientMove 12s ease infinite;
            font-family: 'Poppins', sans-serif;
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            color: white; 
            position: relative;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .content-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative;
        }

        #share-popup {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 400px; background: white; color: #333; padding: 30px;
            border-radius: 24px; z-index: 500; box-shadow: 0 0 100px rgba(0,0,0,0.8); text-align: center;
        }
        #share-url-box { 
            width: 100%; background: #f1f2f6; padding: 12px; border-radius: 12px; 
            font-size: 0.75rem; word-break: break-all; margin: 15px 0; border: 1px dashed var(--accent); color: #555; 
        }
        .popup-btns { display: flex; gap: 10px; }
        .p-btn { flex: 1; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; }

        #setup-screen {
            display: none; 
            background: rgba(255, 255, 255, 0.98); 
            backdrop-filter: blur(15px);
            color: #2d3436; padding: 30px; border-radius: 24px;
            width: 95%; max-width: 500px; z-index: 200; position: absolute;
            max-height: 80vh; overflow-y: auto; 
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
            border: 1px solid var(--border);
        }
        
        #setup-screen::-webkit-scrollbar { width: 5px; }
        #setup-screen::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }

        #setup-screen h2 { color: var(--accent); text-align: center; margin-bottom: 20px; font-size: 1.8rem; border-bottom: 2px solid #f1f2f6; padding-bottom: 10px; }
        .form-section { background: #f9f9f9; padding: 18px; border-radius: 15px; margin-bottom: 20px; border-left: 6px solid var(--accent); }
        .section-title { font-size: 0.8rem; font-weight: 700; color: #b2bec3; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 0.8rem; font-weight: 600; color: #636e72; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; border: 2px solid #dfe6e9; border-radius: 10px; font-family: inherit; font-size: 0.9rem; transition: 0.3s; }
        input:focus { border-color: var(--accent); outline: none; }

        .share-link-btn { width: 100%; padding: 16px; background: #2d3436; color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 1rem; margin-top: 10px; transition: 0.3s; }

        .screen { display: none; text-align: center; width: 90%; max-width: 500px; z-index: 10; }
        #front-page { display: block; }
        
        .envelope { font-size: 110px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); animation: float 3s infinite ease-in-out; cursor: pointer; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-25px) rotate(3deg); } }

        .typewriter-text { font-family: 'Dancing Script', cursive; font-size: 2.4rem; color: #fff; text-shadow: 0 4px 10px rgba(0,0,0,0.3); min-height: 90px; line-height: 1.4; }
        
        .photo-frame { width: 280px; height: 380px; border: 10px solid rgba(255,255,255,0.1); border-radius: 25px; overflow: hidden; margin: 25px auto; position: relative; box-shadow: 0 30px 60px rgba(0,0,0,0.7); backdrop-filter: blur(5px); }
        .photo-frame img { width: 100%; height: 100%; object-fit: cover; }
        .date-badge { position: absolute; top: 15px; right: 15px; background: var(--accent); color: white; padding: 5px 15px; border-radius: 50px; font-size: 0.8rem; font-weight: 600; z-index: 5; }

        .btn { padding: 14px 40px; border-radius: 50px; border: none; cursor: pointer; font-weight: 600; transition: 0.5s; margin-top: 20px; opacity: 0; transform: translateY(30px); background: white; color: #2d3436; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .btn-entry { opacity: 1 !important; transform: translateY(0) !important; }
        .admin-trigger { background: var(--glass); border: 1px solid var(--border); color: rgba(255,255,255,0.5); padding: 10px 20px; font-size: 0.75rem; border-radius: 50px; cursor: pointer; margin: 20px auto 0 auto; display: block; }

        #noBtn { background: white; color: #333; position: absolute; }
        #yesBtn { background: var(--accent); color: white; }

        .footer-section {
            width: 100%;
            padding: 25px 0;
            text-align: center;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(8px);
            border-top: 1px solid rgba(255,255,255,0.05);
            z-index: 100;
        }
        .footer-text {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.4);
            letter-spacing: 1.8px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .falling-heart { position: absolute; top: -50px; color: var(--accent); pointer-events: none; z-index: 1; opacity: 0.5; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
    </style>
</head>
<body>

    <audio id="myAudio" loop><source src="https://image2url.com/r2/default/audio/1769804972813-126816fa-c207-4f45-8133-309e48b02983.mp3" type="audio/mpeg"></audio>

    <div class="content-wrapper">
        <div id="share-popup">
            <h3 style="color:var(--accent)">Link Ready! ‚ù§Ô∏è</h3>
            <div id="share-url-box">Generating...</div>
            <div class="popup-btns">
                <button class="p-btn" style="background:#eee;" onclick="copyLink()">Copy</button>
                <button class="p-btn" style="background:#25D366; color:white;" onclick="shareWA()">WhatsApp</button>
            </div>
            <button onclick="document.getElementById('share-popup').style.display='none'" style="margin-top:15px; background:none; border:none; color:#999; cursor:pointer;">Close</button>
        </div>

        <div id="setup-screen">
            <h2>GENERATE YOUR STORY ‚ú®</h2>
            <div class="form-section">
                <div class="section-title">The Basics</div>
                <div class="input-group"><label>Partner's Name</label><input type="text" id="pName" placeholder="Enter Name"></div>
                <div class="input-group"><label>Mobile (for Call Button)</label><input type="text" id="uPhone" placeholder="Phone number"></div>
            </div>
            <div class="form-section">
                <div class="section-title">Memories (Max 5)</div>
                <div id="photo-inputs-container">
                    <div class="photo-input-row" style="background:#fff; padding:10px; border-radius:10px; margin-bottom:10px; border:1px solid #eee; position:relative;">
                        <button onclick="this.parentElement.remove()" style="position:absolute; top:5px; right:5px; background:none; border:none; color:#ff4757; font-weight:bold; cursor:pointer; font-size:0.75rem;">‚úï Remove</button>
                        <input type="file" class="photo-file" accept="image/*">
                        <div style="display:flex; gap:5px; margin-top:8px;">
                            <input type="text" class="photo-date" placeholder="Date" style="width:35%">
                            <input type="text" class="photo-cap" placeholder="Caption" style="width:65%">
                        </div>
                    </div>
                </div>
                <button onclick="addPhotoField()" style="background:none; border:2px dashed #ddd; color:#999; width:100%; padding:10px; border-radius:10px; cursor:pointer; font-size:0.8rem;">+ Add Slide</button>
            </div>
            <button class="share-link-btn" onclick="generateLink()">Generate Share Link üîó</button>
            <button onclick="closeSetup()" style="background:none; border:none; color:#b2bec3; margin-top:15px; cursor:pointer; width:100%; font-size:0.8rem;">Cancel Changes</button>
        </div>

        <div id="front-page" class="screen">
            <div class="envelope" onclick="showIntro()">üíå</div>
            <h2 id="welcome-text" style="margin-top:25px; font-weight:300;">A Secret Letter Waiting For You...</h2>
            <button class="btn btn-entry" onclick="showIntro()">Unlock Letter</button>
            <button class="admin-trigger" onclick="openSetup()">GENERATE YOUR STORY ‚ú®</button>
        </div>

        <div id="message-screen" class="screen">
            <p class="typewriter-text" id="intro-type"></p>
            <button id="btn-intro" class="btn next-btn" onclick="startMemories()"> Our Memories ‚ú®</button>
        </div>

        <div id="memories-screen" class="screen">
            <div class="photo-frame">
                <div id="date-overlay" class="date-badge"></div>
                <img id="memory-img" src="">
            </div>
            <p class="typewriter-text" id="mem-type" style="font-size: 1.8rem;"></p>
            <button id="btn-mem" class="btn next-btn" onclick="nextMem()">Next ‚Üí</button>
        </div>

        <div id="final-letter" class="screen">
            <p class="typewriter-text" id="letter-type" style="font-size: 2rem;"></p>
            <button id="btn-letter" class="btn next-btn" onclick="showProposal()">I want to tell you something.... üåπ</button>
        </div>

        <div id="proposal-screen" class="screen">
            <p class="typewriter-text" id="proposal-type" style="font-size: 2.5rem;"></p>
            <div id="proposal-btns" style="height: 120px; margin-top:30px; display: none;">
                <button class="btn" id="yesBtn" onclick="showSuccess()">YES! üíç</button>
                <button class="btn" id="noBtn" onmouseover="run()">No</button>
            </div>
        </div>

        <div id="success-screen" class="screen">
            <p class="typewriter-text" id="success-type" style="font-size: 2.8rem;"></p>
            <div id="final-actions" style="margin-top: 40px; display: none; flex-direction: column; gap: 15px; align-items: center;">
                <a id="call-link" href="#" style="text-decoration: none;"><button class="btn btn-entry" style="background: #25D366; color: white; width: 250px;">üìû Call Me My Heart ü§ç</button></a>
                <button class="btn btn-entry" style="width: 250px;" onclick="location.reload()">üîÑ Generate Story</button>
            </div>
        </div>
    </div>

    <footer class="footer-section">
        <div class="footer-text">
            MADE WITH ü§ç BY ‡§π‡§øNDIE VLOGGER<br>
            ¬© 2026 ALL RIGHTS RESERVED
        </div>
    </footer>

    <script>
        const shayaris = [
            "Mohabbat ki kashish toh dekho, har lamha tumhare hi khayal mein guzarta hai. ‚ú®",
            "Tumhari muskurahat hi meri zindagi ka sukoon hai, aur tumhara saath meri sabse badi khwahish. ‚ù§Ô∏è",
            "Zindagi mein sab kuch mil gaya hai, bas ab har subah tumhare naam se shuru ho... üåπ",
            "Meri duniya, mera jahan, mera sukoon... sab tum hi toh ho. ‚ú®",
            "Ek tum aur ek tumhara pyar, bas itni si hai meri duniya. üíç"
        ];

        let config = { 
            pName: "Love", uPhone: "", 
            msg1: "Hamari kahani meri sabse favorite hai... ‚ù§Ô∏è", 
            finalMsg: shayaris[0],
            bigQ: "Will you be my Valentine forever? üíç",
            successMsg: "YAYYY! ‚ù§Ô∏è\nI love you to the moon and back!",
            memories: [
                {img: "https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=500", date: "Moment 1", cap: "Where it began..."},
                {img: "https://images.unsplash.com/photo-1516589174184-c68526671ee6?w=500", date: "Forever", cap: "Together always."}
            ]
        };

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            const storyData = params.get('story');
            if (storyData) {
                try {
                    config = JSON.parse(decodeURIComponent(escape(atob(storyData))));
                    document.getElementById('welcome-text').innerText = "A secret letter for " + config.pName + "...";
                } catch(e) { console.error("Error loading story"); }
            }
        };

        function openSetup() { document.getElementById('setup-screen').style.display = 'block'; }
        function closeSetup() { document.getElementById('setup-screen').style.display = 'none'; }

        function addPhotoField() {
            const container = document.getElementById('photo-inputs-container');
            if(container.children.length >= 5) { alert("Max 5 memories allowed!"); return; }
            const row = document.createElement('div');
            row.className = "photo-input-row";
            row.style = "background:#fff; padding:10px; border-radius:10px; margin-bottom:10px; border:1px solid #eee; position:relative;";
            row.innerHTML = `<button onclick="this.parentElement.remove()" style="position:absolute; top:5px; right:5px; background:none; border:none; color:#ff4757; font-weight:bold; cursor:pointer; font-size:0.75rem;">‚úï Remove</button><input type="file" class="photo-file" accept="image/*"><div style="display:flex; gap:5px; margin-top:8px;"><input type="text" class="photo-date" placeholder="Date" style="width:35%"><input type="text" class="photo-cap" placeholder="Caption" style="width:65%"></div>`;
            container.appendChild(row);
        }

        async function uploadToCloudinary(blob) {
            const formData = new FormData();
            formData.append('file', blob);
            formData.append('upload_preset', 'love_preset');
            const res = await fetch(`https://api.cloudinary.com/v1_1/dk63y3zia/image/upload`, { method: 'POST', body: formData });
            const data = await res.json();
            return data.secure_url;
        }

        const fastCompress = (file) => new Promise((resolve) => {
            const reader = new FileReader(); reader.readAsDataURL(file);
            reader.onload = (e) => {
                const img = new Image(); img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                    const MAX = 800; let w = img.width, h = img.height;
                    if (w > h) { if (w > MAX) { h *= MAX / w; w = MAX; } } else { if (h > MAX) { w *= MAX / h; h = MAX; } }
                    canvas.width = w; canvas.height = h; ctx.drawImage(img, 0, 0, w, h);
                    canvas.toBlob((blob) => resolve(blob), 'image/jpeg', 0.7);
                };
            };
        });

        async function generateLink() {
            const btn = document.querySelector('.share-link-btn');
            btn.innerText = "Uploading Memories... ‚ù§Ô∏è";
            btn.disabled = true;

            config.pName = document.getElementById('pName').value || "My Love";
            config.uPhone = document.getElementById('uPhone').value;
            // Default Texts
            config.msg1 = "Hamari kahani meri sabse favorite hai... ‚ù§Ô∏è";
            config.finalMsg = shayaris[Math.floor(Math.random() * shayaris.length)];
            config.bigQ = "Will you be my Valentine forever? üíç";
            config.successMsg = "YAYYY! ‚ù§Ô∏è\nI love you to the moon and back!";
            
            const fileInputs = document.querySelectorAll('.photo-file');
            const dateInputs = document.querySelectorAll('.photo-date');
            const capInputs = document.querySelectorAll('.photo-cap');
            let newMems = [];

            for(let i=0; i<fileInputs.length; i++) {
                if(fileInputs[i].files[0]) { 
                    try {
                        const compressedBlob = await fastCompress(fileInputs[i].files[0]);
                        const imgUrl = await uploadToCloudinary(compressedBlob); 
                        newMems.push({img: imgUrl, date: dateInputs[i].value || "Memory", cap: capInputs[i].value || "‚ù§Ô∏è"});
                    } catch(err) { console.error("Upload failed"); }
                }
            }
            if(newMems.length > 0) config.memories = newMems;

            const storyString = btoa(unescape(encodeURIComponent(JSON.stringify(config))));
            const url = window.location.origin + window.location.pathname + "?story=" + storyString;
            
            document.getElementById('share-url-box').innerText = url;
            document.getElementById('share-popup').style.display = 'block';
            btn.innerText = "Generate Share Link üîó";
            btn.disabled = false;
            closeSetup();
        }

        function copyLink() { navigator.clipboard.writeText(document.getElementById('share-url-box').innerText); alert("Link Copied! ‚úÖ"); }
        function shareWA() { window.open("https://api.whatsapp.com/send?text=" + encodeURIComponent("Special for you: " + document.getElementById('share-url-box').innerText)); }

        function typeWriter(text, elementId, actionId, speed = 50) {
            let i = 0; const elem = document.getElementById(elementId); const actionElem = document.getElementById(actionId);
            elem.innerHTML = ""; if(actionElem) actionElem.style.display = "none";
            function typing() {
                if (i < text.length) { elem.innerHTML += text.charAt(i) === '\n' ? '<br>' : text.charAt(i); i++; setTimeout(typing, speed); }
                else if(actionElem) { 
                    actionElem.style.display = "block"; 
                    setTimeout(() => {
                        const btns = actionElem.querySelectorAll('.btn');
                        if(btns.length > 0) btns.forEach(b => { b.style.display = "inline-block"; setTimeout(() => b.classList.add('btn-entry'), 50); });
                        else actionElem.classList.add('btn-entry');
                    }, 300);
                }
            }
            typing();
        }

        function showIntro() {
            document.getElementById('myAudio').play().catch(() => {});
            document.getElementById('front-page').style.display = 'none';
            document.getElementById('message-screen').style.display = 'block';
            typeWriter(config.msg1, "intro-type", "btn-intro");
        }

        let mIdx = 0;
        function startMemories() { document.getElementById('message-screen').style.display = 'none'; document.getElementById('memories-screen').style.display = 'block'; loadMem(); }
        function loadMem() {
            const cur = config.memories[mIdx];
            document.getElementById('date-overlay').innerText = cur.date;
            document.getElementById('memory-img').src = cur.img;
            typeWriter(cur.cap, "mem-type", "btn-mem", 40);
        }
        function nextMem() {
            mIdx++; if (mIdx < config.memories.length) loadMem();
            else { 
                document.getElementById('memories-screen').style.display = 'none'; document.getElementById('final-letter').style.display = 'block';
                typeWriter(config.finalMsg, "letter-type", "btn-letter", 60);
            }
        }
        function showProposal() {
            document.getElementById('final-letter').style.display = 'none'; document.getElementById('proposal-screen').style.display = 'block';
            typeWriter(config.bigQ, "proposal-type", "proposal-btns", 70);
        }
        function run() {
            const b = document.getElementById('noBtn'); b.style.display = "inline-block";
            const x = Math.max(10, Math.random() * (window.innerWidth - 120));
            const y = Math.max(10, Math.random() * (window.innerHeight - 150));
            b.style.position = 'fixed'; b.style.left = x + 'px'; b.style.top = y + 'px';
        }
        function showSuccess() {
            document.getElementById('proposal-screen').style.display = 'none'; document.getElementById('success-screen').style.display = 'block';
            document.getElementById('call-link').href = "tel:" + config.uPhone;
            typeWriter(config.successMsg, "success-type", "final-actions", 60);
        }

        setInterval(() => {
            const h = document.createElement('div'); h.className = 'falling-heart'; h.innerHTML = '‚ù§Ô∏è';
            h.style.left = Math.random() * 100 + 'vw'; const d = Math.random() * 3 + 6; h.style.animationDuration = d + 's';
            document.body.appendChild(h); setTimeout(() => h.remove(), d * 1000);
        }, 700);
    </script>
</body>
</html>
